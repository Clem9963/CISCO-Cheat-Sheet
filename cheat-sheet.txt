Réseaux fiables :
- Tolérance aux pannes
- Évolutivité
- Qualité de service (QoS)
- Sécurité

* Initialiser un routeur :

Allumer le routeur
Le brancher avce un câble bleur ciel prise RJ45 entre un PC et le port console
Ouvrir le terminal
> minicom
Si erreur :
> minicom -s (ou si déjà lancé Ctrl-A Z)
> Configuration du Port série
> /dev/modem -> /dev/ttyS1 (ou /dev/ttyS0 -> tester les 2 pas d'autres moyens de le savoir)
> Entrée
> Changer le Débit à 9600
> echap
> Enregistrer config. sous dfl
> "Enter initial configuration dialog"
> no
> Entrée
Commandes CISCO IOS :

* Renommer un routeur (en R1, R2 ...) :

> enable
> configure terminal
> hostame [R1]       (Sans les crochets)
> exit

* Configurer les adresses ip d'un routeur :

> enable
> configure terminal
> interface FastEthernet0/0
> ip address 192.168.X.X + 255.X.X.X
> no shutdown
> show ip interface brief (Pour vérifier)

* RIPv2 (d'abord faire l'étape au-dessus) :
> enable
> config t
> router rip
> version 2
> no auto-summary
> network X.X.X.X (@ du 1er réseau dans lequel se trouve le routeur)
> network X.X.X.X (@ du 2ème réseau dans lequel se trouve le routeur)
> ...
> exit

* Configurer la table de routage d'un routeur (manuellement)

> enable
> config t
> ip route X.X.X.X Y.Y.Y.Y Z.Z.Z.Z (avec X.X.X.X l'adresse source, Y.Y.Y.Y le masque du sous-réseau et Z.Z.Z.Z la passerelle OU ALORS mettre l'interface, par exemple:FastEthernet0/0)
> exit
> show ip route


> show controllers serial

* Configurer clock pour les réseaux câblés avec les câbles séries
> enable
> show ip interface brief (Pour savoir quel est le serial dont on doit changer la clock)
> config t
> interface Serial 0/0/X (avec X le bon numéro de série)
> clock rate X (avec X la valeur en bauds, ici 2000000)
> exit


* Configurer adresse ip d'un PC (sous CentOS 7) :
> Cliquer sur l'icône des 2 câbles branchés en bas à droite (Ou Paramètres système puis Réseau)
> Cliquer sur l'engrenage
> IPv4
> Dans "Adresses" Changer Automatique(DHCP) en "Manuel"
> Remplir les champs qui apparaissent
> Appliquer
> Puis déconnecter, reconnecter avec le widget qui slide de gauche à droite


* Supprimer la configuration du switch :
> enable
> erase startup-config
> reload
> Ne pas sauvegarder (Sinon il copie la running config dans la startup-config)

* Sur un switch il faut aussi effacer le fichier vlan.dat :
> enable
> 
>delete flash:vlan.dat reload
> Ne pas sauvegarder

* Donner un nom à un VLAN :
> enable
> config-t
> vlan X (X = Numéro du VLAN)
> name Y (Y = Nom du VLAN)

* Configurer les ports d'un VLAN :
> enable
> show vlan (pour savoir où est quelle interface)
> config-t
> interface FastEthernet0/X (X = le numéro de l'interface)
> switchport mode access
> switchport access vlan X (X = le numéro du VLAN dans lequel on souhaite que l'interface appartienne)
> exit


sécuriser : 
enable secret password

chiffrer mot de passe : 
service password-encryption

blouer au bout d'un nombre de connexion : 
login block-for 120 attempts 3 within 60

configuration de mot de passe : 
enable
enable secret class
line console 0
password cisco
login 
exit
line vty 0 4
password cisco
login
exit
service password-encryption

activer le ssh : 
conf t
ip domain-name span.com
crypto key generate rsa general-keys modulus 1024
username admin secret ccna
line vty 0 15
transport input ssh
login local
exit
ip ssh version 2
exit

debugguer : 
tracert
traceroute
ping
debug ip icmp
undebug all
no debup ip icmp
terminal monitor

message de banniere : 
banner motd $monmessage$

configurer une interface de router : 
enable
conf t
interface fastethernet 0/1
ip address 192.168.10.2 255.255.255.0
description link to lan 1
no shutdown
exit

configurer la passerelle par defaut : 
ip default-gateway 192.168.10.1

configurer de l'ipv6 : 
enable 
conf t
int fastethernet0/1
ipv6 address 2001:db8:acab:1::1/64
no shutdown
exit

configurer la clock
enable 
conf t
int fastethernet0/1
clock rate 2000000
no shutdown

configuration link-local
enable
conf t
int fastethernet0/1
description link to lan 2
ipv6 addresse fe80::1 link-local
clock rate 200000
no shutdown
exit

configurer une interface de bouclage : 
interface loopback 0
ip address 10.0.0.1 255.255.255.0
exit

supprimer config d'un routeur / switch
erase startup-config
delete flash:vlan.dat (seulement pour les switch)
reload

voir les interfaces : 
show ip interface brief
show ipv6 interface brief


voir la table de routage : 
show startup-config
show running-config
show ip route
show ipv6 route
show running-config interface fastethernet0/1
show ip route | begin Gateway
show ip route static
show port-security interface fe0/1
show vlan brief
show interfaces vlan 10
show access-lists
clear access-lists counter (num de l'acl)
show ip nat translations
show cdp
show cdp neighbors
show cdp interface
show ip nat statistics
clear ip nat
debug ip nat

voir la version de IOS : 
show version

faire une route statique : 
ip route 192.168.10.0 255.255.255.0 s0/0/0
ipv6 route ::/0 s0/0/0
ipv6 route 2001:0DB8:ACAB:1::/64 2001:0DB8:ACAD:3::1
exit

configurer une route statique de tronçon suivant : 
ip route 172.16.1.0 255.255.255.0 172.16.2.2
ip route 192.168.1.0. 255.255.255.0 172.16.2.2

configurer un route statique connectée directement :
ip route 172.16.1.0 255.255.255.0 s0/0/0
ip route 192.168.1.0 255.255.255.0 s0/0/0

configurer des routes statiques entièrement spécifiées : 
ip route 172.16.1.0 255.255.255.0 G0/1 172.16.2.2
ip route 192.168.1.0 255.255.255.0 G0/1 172.16.2.2

route statique par défaut : 
ip route 0.0.0.0 0.0.0.0 172.16.2.2

configurer des routes ipv6 de troncon suivant : 
ipv6 route 2001:DB8:ACAD:2::/64 2001:DB8:ACAD:4::2

configurer un route statique ipv6 connectée directement :
ipv6 route 2001:DB8:ACAD:2::/64 s0/0/0

configurer des routes statiques ipv6 entièrement spécifiées : 
ipv6 rpite 2001:DB8:ACAD:2::/64 fe80::2

route statique ipv6 par défaut : 
ipv6 route ::/0 2001:DB8:ACAD:4::2

configurer une route statique flottante : 
ip route 0.0.0.0 0.0.0.0 172.16.2.2

configurer une route statique ipv6 flottante : 
ipv6 route ::/0 2001:DB8:ACAD:4::2

faire du routage rip : 
enable
conf t
router rip
version 2
no auto-summary
network x.x.x.x (1er réseau)
network y.y.y.y (2eme reseau)
..
exit


configurer des interfaces passives : 
router rip
passive-interface g0/0
end


configurer un switch : 
conf t
vlan 10
exit
interface fe0/1
switchport mode access
switchport access vlan 10
exit

configuration commutateur en mode full duplex : 
conf t
int fe0/1
duplex full
speed 100
end

mettre le MDIX : 
conf t
int fe0/1
duplex auto
speed auto
mdix auto
end

commutateur securiser le port : 
conf t 
int fe0/1
switchport mode access
switchport port-security

1) création d'un vlan ; 
conf t
vlan 10
name student
end

2) attribution d'un port à un vlan
conf t
int fe0/1
swicthport mode access
switchport access vlan 10
end

3) modification de l'appartenance des ports aux vlan
int fe0/1
no switchport access vlan
end

4) suppression de vlan
conf t
no vlan 10
end


configurer liaison trunk : 
conf t
int fe0/4
switchport mode trunk
switchport trun native vlan 99
switchport trunk allowed vlan 10,20,30,99
end

réinitialisation de trunk par defaut : 
int fe0/1
no switchport trunk allowed vlan
no switchport trunk native vlan
switchport mode access
end

ACL et mot cle de masque générique : 
conf t
access-list 1 permit 0.0.0.0 255.255.255.255
!OR
access-listt 1 permit any

access-list 1 permit 192.168.10.10 0.0.0.0
!OR
access-list 1 permit host 192.168.10.10

autoriser une adresse ipv4 dans une ACL : 
access-list 10 permit 192.168.10.0 0.0.0.255

supprimer les acl 
no access-list 10

configurer une acl sur une interface :
conf t
access-list 1 permit 192.168.10.0 0.0.0.255
int serial0/0/0
ip access-group 1 out

autoriser tout le monde sauf une addresse : 
conf t
no access-list 1
access-list 1 deny host 192.168.10.10
access-list 1 permit any
int g0/0
ip access-group 1 in

nommer une ACL
ip access-list standart NO_ACCESS
deny host 19.168.11.10
permit any
exit
int g0/0
ip access-group NO_ACCESS out

sécuriser le port VTY
conf t
line vty 0 4
login local
transport input ssh
access-class 21 in
exit
access-list 21 permit 19.168.10.0 0.0.0.255
access-list 21 deny any


Configurer du DHCP sur un router : 

exclure une adresse ip : 
enable
ip dhcp excluded-address 192.168.10.254

exclure un pool d'adresse
ip dhcp excluded-address 192.168.10.1 192.168.10.9

configurer le dhcp : 
enable
ip dhcp excluded-address 192.168.10.1
ip dhcp pool LAN-POOL-1
network 192.168.10.0 255.255.255.0
default-router 192.168.10.1 //pesserelle par default
(facul) dns-server 192.168.11.5
(facul) domain-name example.com
end

afficher le dhcp configuré : 
show running-config | section dhcp
show ip dhcp binding
show ip dhcp server statistics
show running-config |section interface g0/0

faire un relai dhcpv4 : 
conf t 
int g0/0
ip helper-addresse 192.168.11.6

configurer un router en tant que client dhcp :
conf t
int g0/1
ip address dhcp
no shutdown
end

afficher les conflits  :
show ip dhcp conflict


Configurer le dhcpv6 sans etat : 
conf t
ipv6 unicast-routing
ipv6 dhcp IPV6-STATELESS
dns-server 2001:db8:cafe:aaaa::5
domain-name example.com
exit
int g0/1
ipv6 address 2001:db8:cafe:1::1/64
ipv6 dhcp server IPV6-STATELESS
ipv6 nb other-config-flag


configurer le dhcpv6 avec etat : 
conf t
ipv6 unicast-routing
ipv6 dhcp IPV6-STATEFUL
address prefix 2001:db8:cafe:1::/64 lifetime infinite
dns-server 2001:db8:cafe:aaaa::5
domain-name example.com
exit
int g0/1
ipv6 address 2001:db8:cafe:1::1/64
ipv6 dhcp server IPV6-STATEFUL
ipv6 nb managed-config-flag

permettre au routeur de recevoir une adresse link local : 
int g0/1
ipv6 enable
ipv6 address dhcp

Configurer un routeur en tant qu'agent de relais DHCPV6 : 
int g0/1
ipv6 dhcp relay destination 2001:db8:cafe:1::6
end
show ipv6 dhcp interface g0/0



Configurer une traduction NAT
conf t
ip nat inside source static 192.168.11.99 209.165.201.5
interface serial0/0/0
ip address 192.168.1.2 255.255.255.252
ip nat inside
exit
int serial0/1/0
ip address 209.165.100.1 255.255.255.252
ip nat outside


configurer NAT dynamique : 
conf t
ip nat pool NAT-POOL1 209.165.200.226
netmask 255.255.255.224
access-list 1 permit 192.168.0.0 0.0.255.255
ip nat inside source list 1 pool NAT-POOL1
int serial 0/0/0
ip nat inside

Configuration de PAT : 
conf t
ip nat pool NAT-POOL2 209.165.200.226
netmask 255.255.255.224
access-list 1 permit 192.168.0.0 0.0.255.255
ip nat inside source list 1 pool NAT-POOL2 overload
int serial0/0/0
ip nat inside
int serial0/1/0
ip nat outside

Configuration de PAT avec une seule adresse externe :
conf t
ip nat inside source list 1 interface serial FastEthernet4 overload (FastEthernet4 est l'interface du réseau externe)
access-list 1 permit 192.168.20.0 0.0.0.255
exit
interface Vlan1 (Vlan1 est l'interface du réseau interne)
ip nat inside
exit
interface FastEthernet4
ip nat outside

autres exemple : 
conf t
access-list permit 192.16.0.0 0.0.255.255 (configurer acl1 pour permettre trad NAT)
int serial0/0/0
ip nat inside
int serial0/1/0
ip nat outside


Configurer transfert de port
conf t
ip nat inside source static tcp 192.168.10.254 80 209.165.200.225
int serial0/0/0
ip nat inside
int serial0/1/0
ip nat outside



Configuration du protocole CDP : 
enable
conf 
int giga0/1
cdp enable

desactivation globale : 
no cdp run
exit


Configuration du protocole LLDP : 
conf t
lldp run
int giga0/1
lldp transmit
lldp receive
show lldp


clock set 20:36:00 dec 11 2015


Configuration du protocole NTP (pour l'heure) : 
show click detail
ntp server 209.165.200.225
end
show clock detail
show ntp associations

show logging | include changed state to up


maintenance des fichiers du routeur et commutateurs : 
show file system
dir
cd nvram:
pwd
copy running-config usbflash0:

